<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>US&R Eagle Vision Query Page</title>

    <!--Firebase -->
    <script src = "https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    <!--Timestamp Format -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<!-- 
Journey Template 
http://www.templatemo.com/tm-511-journey
-->

<!-- load stylesheets -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">  <!-- Google web font "Open Sans" -->
<link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">                <!-- Font Awesome -->
<link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
<link rel="stylesheet" type="text/css" href="css/datepicker.css"/>
<link rel="stylesheet" type="text/css" href="slick/slick.css"/>
<link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>
<link rel="stylesheet" href="css/templatemo-style.css">                                   <!-- Templatemo style -->

<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<title>Predefined Symbols (Marker)</title>
<style>
#map {
    width: 100%;
    height: 720px;
    background-color: grey;
}
</style>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
            <!--[if lt IE 9]>
              <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
              <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
      </head>

      <body>
        <div class="tm-main-content" id="top">
            <div class="tm-top-bar-bg"></div>    
            <div class="tm-top-bar" id="tm-top-bar">
                <div class="container">
                    <div class="row">
                        <nav class="navbar navbar-expand-lg narbar-light">
                            <a class="navbar-brand mr-auto" href="#">
                                <img src="img/TF1.png" alt="Site logo">
                                US&R Eagle Vision Query Nest
                            </a>
                            <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                                <ul class="navbar-nav ml-auto">
                                  <li class="nav-item">
                                    <a class="nav-link active" href="#top">HOME <span class="sr-only">(current)</span></a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tm-section-2"></a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tm-section-3">Query Results</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tm-section-4"></a>
                                </li>
                            </ul>
                        </div>                            
                    </nav>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- .tm-top-bar -->

        <div class="tm-page-wrap mx-auto">
            <section class="tm-banner">
                <div class="tm-container-outer tm-banner-bg">



                    <body>
                        <div id="map"></div>

                        <script>
            //this function starts up the map..Rest of map functions start on line 141
            var map, infoWindow;
            function initMap()              
        </script>

        
    </body>                 
</div>     <!-- .tm-container-outer -->                 
</section>


<div class="tm-container-outer" id="tm-section-3">

   <footer class="tm-container-outer">
    <p class="mb-0">Copyright © <span class="tm-current-year">2019</span> University of Washington Tacoma, MSGT Program

        . Designed by <a rel="nofollow" target="_parent">Greg Mireles</a></p>
    </footer>             

    <table style="width:100%" id="ex-table">
      <tr id="tr">
        <th>Description:</th>
        <th>MarkerLocation:</th> 
        <th>Perimeter:</th>
        <th>Structure:</th>
        <th>TimeStamp:</th>
    </tr>
</table>


<script>

//GLOBAL VARIABLES
var myLatLng;

function myMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center: new google.maps.LatLng(47.2446, -122.4376),
      streetViewControl: false,
      zoom: 11
  });
}

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXvJ72oaaTTtLCj5XYS2EcPyMtEb1kyWQ&callback=myMap"></script>


<section class="p-5 tm-container-outer tm-bg-gray">            
   <div class="container">
     <div class="row">
        <div class="col-xs-12 mx-auto tm-about-text-wrap text-center">                        

            <div class="row">
              <div class="col-25">

                  <script>      
                    var messagesRef = new Firebase('https://usr-eagle-view.firebaseio.com');

                    messagesRef.limitToLast(100).on('child_added', function (snapshot) {
                        var data = snapshot.val();
                        console.log(snapshot.val());
                        var Description = data.Description;
                        var MarkerLocation = data.MarkerLocation;
                        var length = MarkerLocation.length;
                        var start = MarkerLocation.indexOf(",")+2;
                        var latend = MarkerLocation.indexOf(",")-1;
                        var latlength = latend-1;
                        var end = MarkerLocation.indexOf(")")-1;
                        var strlength = end - start;
                        var lat = parseFloat(MarkerLocation.substr(1,latlength));
                        console.log(lat);
                        var long = parseFloat(MarkerLocation.substr(start,strlength));
                        console.log(long);
                        var Perimeter = data.Perimeter;
                        var Structure = data.Structure;
                        var Timestamp = data.Timestamp;


                        console.log(Description);
                        console.log(MarkerLocation);
                        console.log(Perimeter);
                        console.log(Structure);
                        console.log(Timestamp);
                        console.log('***');
                        if (data != undefined)
                        {
                          var content = '';
                          content +='<tr>';
                          content += '<td>' + Description + '</td>';
                          content += '<td>' + MarkerLocation + '</td>';
                          content += '<td>' + Perimeter + '</td>';
                          content += '<td>' + Structure + '</td>';
                          content += '<td>' + Timestamp + '</td>';
                          content += '</tr>';
                          $('#ex-table').append(content);

                        var myLatlng = new google.maps.LatLng(lat, long);

                        var marker = new google.maps.Marker({
                            position: myLatlng,
                            info: data,
                            visible: true
                            
                          });

                         marker.setMap(map);

                         var infowindow = new google.maps.InfoWindow({
                          content: content
                        });

                         marker.addListener('click', function() {
                          infowindow.open(map, marker);
                          });

                         }

                  });

</script>






</div>         
</div>
</div>
</div>            
</section>


<!-- .tm-container-outer -->

<footer class="tm-container-outer">
    <p class="mb-0">Copyright © <span class="tm-current-year">2019</span> University of Washington Tacoma, MSGT Program

        . Designed by <a rel="nofollow" target="_parent">Greg Mireles</a></p>
    </footer>
</div>
</div> <!-- .main-content -->



<!-- load JS files -->
<script src="js/localforage.js"></script>                   <!-- localforage --> 
<script src="js/jquery-1.11.3.min.js"></script>             <!-- jQuery (https://jquery.com/download/) -->
<script src="js/popper.min.js"></script>                    <!-- https://popper.js.org/ -->       
<script src="js/bootstrap.min.js"></script>                 <!-- https://getbootstrap.com/ -->
<script src="js/datepicker.min.js"></script>                <!-- https://github.com/qodesmith/datepicker -->
<script src="js/jquery.singlePageNav.min.js"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
<script src="slick/slick.min.js"></script>                  <!-- http://kenwheeler.github.io/slick/ -->
<script src="js/jquery.scrollTo.min.js"></script>           <!-- https://github.com/flesler/jquery.scrollTo -->


<script>
        /* DOM is ready
        ------------------------------------------------*/
        $(function(){

            // Change top navbar on scroll
            $(window).on("scroll", function() {
                if($(window).scrollTop() > 100) {
                    $(".tm-top-bar").addClass("active");
                } else {                    
                   $(".tm-top-bar").removeClass("active");
               }
           });

            // Smooth scroll to search form
            $('.tm-down-arrow-link').click(function(){
                $.scrollTo('#tm-section-search', 300, {easing:'linear'});
            });

            // Date Picker in Search form
            var pickerCheckIn = datepicker('#inputCheckIn');
            var pickerCheckOut = datepicker('#inputCheckOut');

            // Update nav links on scroll
            $('#tm-top-bar').singlePageNav({
                currentClass:'active',
                offset: 60
            });

            // Close navbar after clicked
            $('.nav-link').click(function(){
                $('#mainNav').removeClass('show');
            });

            // Slick Carousel
            $('.tm-slideshow').slick({
                infinite: true,
                arrows: true,
                slidesToShow: 1,
                slidesToScroll: 1
            });
        </script>             

    </body>
    </html>